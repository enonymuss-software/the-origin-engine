<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Origin Engine</title>
    <style>
        /* This section controls the "look" of the page */
        body { margin: 0; background-color: #050505; color: #00ffcc; font-family: monospace; overflow: hidden; }
        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        .status-text { font-size: 1.2rem; text-shadow: 0 0 10px #00ffcc; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="status-text">THE ORIGIN ENGINE: GOD MODE</div>
        <div id="system-readout">SYSTEM STABLE: 1.0.0</div>
        <hr style="border: 1px solid #00ffcc; margin: 10px 0;">
        
        <div class="control-group" style="pointer-events: auto;">
            <label>WORLD ROTATION</label><br>
            <input type="range" id="speedSlider" min="0" max="0.01" step="0.0001" value="0.0005"><br>
            
            <label>LIFE SPEED</label><br>
            <input type="range" id="lifeSlider" min="0" max="0.1" step="0.001" value="0.02"><br>
            
            <label>SEA LEVEL</label><br>
            <input type="range" id="seaSlider" min="-2" max="2" step="0.1" value="0">
        </div>
    </div>

    <div id="world-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // 1. THE SCENE
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020205); // Deep space black

        // 2. THE CAMERA
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 7, 12);
        camera.lookAt(0, 0, 0);

        // 3. THE RENDERER
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('world-container').appendChild(renderer.domElement);

        // 4. THE LIGHTING
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);
        const sunLight = new THREE.DirectionalLight(0xffffff, 3);
        sunLight.position.set(5, 10, 7);
        scene.add(sunLight);

        // 5. THE LANDSCAPE
        const size = 20;
        const segments = 100;
        const geometry = new THREE.PlaneGeometry(size, size, segments, segments);
        const vertices = geometry.attributes.position.array;
        const colors = [];
        const color = new THREE.Color();

        for (let i = 0; i < vertices.length; i += 3) {
            const x = vertices[i];
            const y = vertices[i + 1];
            // Complex terrain math
            const height = Math.sin(x * 0.4) * Math.cos(y * 0.4) * 2 + Math.sin(x * 2) * 0.2;
            vertices[i + 2] = height;

            if (height < 0) color.setHex(0x0044ff);      // Deep Water
            else if (height < 0.2) color.setHex(0x0088ff); // Shallow Water
            else if (height < 1.5) color.setHex(0x22aa22); // Grass
            else color.setHex(0xeeeeee);                 // Snow
            colors.push(color.r, color.g, color.b);
        }
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        const terrain = new THREE.Mesh(geometry, new THREE.MeshStandardMaterial({ vertexColors: true, flatShading: true }));
        terrain.rotation.x = -Math.PI / 2;
        scene.add(terrain);

        // 6. THE LIFE SPARK (Particle System)
        const particleCount = 500;
        const pGeometry = new THREE.BufferGeometry();
        const pPositions = new Float32Array(particleCount * 3);
        const pVelocities = [];

        for (let i = 0; i < particleCount; i++) {
            // Start particles at random spots
            pPositions[i * 3] = (Math.random() - 0.5) * 15; // X
            pPositions[i * 3 + 1] = 5;                      // Y (Height)
            pPositions[i * 3 + 2] = (Math.random() - 0.5) * 15; // Z
            pVelocities.push({ x: (Math.random() - 0.5) * 0.02, z: (Math.random() - 0.5) * 0.02 });
        }

        pGeometry.setAttribute('position', new THREE.BufferAttribute(pPositions, 3));
        const pMaterial = new THREE.PointsMaterial({ color: 0x00ffcc, size: 0.1, transparent: true, opacity: 0.8 });
        const lifeForms = new THREE.Points(pGeometry, pMaterial);
        scene.add(lifeForms);

        // 7. THE GOD CONSOLE LOGIC
        const speedSlider = document.getElementById('speedSlider');
        const lifeSlider = document.getElementById('lifeSlider');
        const seaSlider = document.getElementById('seaSlider');

        // 8. THE ANIMATION LOOP (With Environmental Awareness)
        function animate() {
            requestAnimationFrame(animate);
            
            terrain.rotation.z += parseFloat(speedSlider.value);
            terrain.position.y = parseFloat(seaSlider.value);

            const positions = lifeForms.geometry.attributes.position.array;
            const currentLifeSpeed = parseFloat(lifeSlider.value);

            for (let i = 0; i < particleCount; i++) {
                // Get current horizontal position
                const x = positions[i * 3];
                const z = positions[i * 3 + 2];

                // --- THE SENSORY CALCULATION ---
                // We calculate the height of the mountain at THIS specific spot
                // using the same math we used to build the land.
                const landHeight = Math.sin(x * 0.4) * Math.cos(z * 0.4) * 2 + Math.sin(x * 2) * 0.2;
                
                let movementMultiplier = 1.0;
                
                if (landHeight + terrain.position.y < 0.2) {
                    // THEY ARE IN WATER: Panicked swimming (Faster)
                    movementMultiplier = 3.0;
                    pMaterial.color.setHex(0x00ffff); // Turn brighter blue
                } else {
                    // THEY ARE ON LAND: Calm grazing (Slower)
                    movementMultiplier = 0.5;
                    pMaterial.color.setHex(0x00ffcc); // Return to teal
                }

                // Apply movement based on environment
                positions[i * 3] += (Math.random() - 0.5) * currentLifeSpeed * movementMultiplier;
                positions[i * 3 + 2] += (Math.random() - 0.5) * currentLifeSpeed * movementMultiplier;

                // Boundary Check
                if (Math.abs(positions[i * 3]) > 9) positions[i * 3] *= -0.9;
                if (Math.abs(positions[i * 3 + 2]) > 9) positions[i * 3 + 2] *= -0.9;

                // Vertical Hover (Bobbing)
                positions[i * 3 + 1] = 2 + Math.sin(Date.now() * 0.002 + i);
            }
            lifeForms.geometry.attributes.position.needsUpdate = true;
            
            renderer.render(scene, camera);
        }

        animate();
        document.querySelector('.status-text').innerText = "THE ORIGIN ENGINE: LIFE DETECTED";
    </script>
</body>
</html>
